{% extends "wod/characters/werewolf/werewolf/detail.html" %}
{% load dots %}
{% load resonance %}
<form method="post">
    {% csrf_token %}
    {% block attributes %}
        <div class="centertext container">
            <div class="row">
                <h2 class="col-sm {{ object.get_heading }}">Attributes</h2>
            </div>
            <div class="row">
                <div class="col-sm">Strength</div>
                <div class="col-sm">{{ form.strength }}</div>
                <div class="col-sm">Charisma</div>
                <div class="col-sm">{{ form.charisma }}</div>
                <div class="col-sm">Perception</div>
                <div class="col-sm">{{ form.perception }}</div>
            </div>
            <div class="row">
                <div class="col-sm">Dexterity</div>
                <div class="col-sm">{{ form.dexterity }}</div>
                <div class="col-sm">Manipulation</div>
                <div class="col-sm">{{ form.manipulation }}</div>
                <div class="col-sm">Intelligence</div>
                <div class="col-sm">{{ form.intelligence }}</div>
            </div>
            <div class="row">
                <div class="col-sm">Stamina</div>
                <div class="col-sm">{{ form.stamina }}</div>
                <div class="col-sm">Appearance</div>
                <div class="col-sm">{{ form.appearance }}</div>
                <div class="col-sm">Wits</div>
                <div class="col-sm">{{ form.wits }}</div>
            </div>
        </div>
    {% endblock attributes %}
    {% block abilities %}
        <div class="row">
            <h2 class="col-sm {{ object.get_heading }}">Abilities</h2>
        </div>
        <div class="row">
            <h3 class="col-sm {{ object.get_heading }}">Talents</h3>
            <h3 class="col-sm {{ object.get_heading }}">Skills</h3>
            <h3 class="col-sm {{ object.get_heading }}">Knowledges</h3>
        </div>
        <div class="row">
            <div class="col-sm">
                Alertness
            </div>
            <div class="col-sm">{{ form.alertness }}</div>
            <div class="col-sm">
                Animal Ken
            </div>
            <div class="col-sm">{{ form.animal_ken }}</div>
            <div class="col-sm">
                Academics
            </div>
            <div class="col-sm">{{ form.academics }}</div>
        </div>
        <div class="row">
            <div class="col-sm">
                Athletics
                {% if athletics_spec %}({{ athletics_spec }}){% endif %}
            </div>
            <div class="col-sm">{{ form.athletics }}</div>
            <div class="col-sm">
                Crafts
                {% if crafts_spec %}({{ crafts_spec }}){% endif %}
            </div>
            <div class="col-sm">{{ form.crafts }}</div>
            <div class="col-sm">
                Computer
                {% if computer_spec %}({{ computer_spec }}){% endif %}
            </div>
            <div class="col-sm">{{ form.computer }}</div>
        </div>
        <div class="row">
            <div class="col-sm">
                Brawl
                {% if brawl_spec %}({{ brawl_spec }}){% endif %}
            </div>
            <div class="col-sm">{{ form.brawl }}</div>
            <div class="col-sm">
                Drive
                {% if drive_spec %}({{ drive_spec }}){% endif %}
            </div>
            <div class="col-sm">{{ form.drive }}</div>
            <div class="col-sm">
                Enigmas
                {% if enigmas_spec %}({{ enigmas_spec }}){% endif %}
            </div>
            <div class="col-sm">{{ form.enigmas }}</div>
        </div>
        <div class="row">
            <div class="col-sm">
                Empathy
                {% if empathy_spec %}({{ empathy_spec }}){% endif %}
            </div>
            <div class="col-sm">
                {{ form.empathy }}
            </div>
            <div class="col-sm">
                Etiquette
                {% if etiquette_spec %}({{ etiquette_spec }}){% endif %}
            </div>
            <div class="col-sm">
                {{ form.etiquette }}
            </div>
            <div class="col-sm">
                Investigation
                {% if investigation_spec %}({{ investigation_spec }}){% endif %}
            </div>
            <div class="col-sm">
                {{ form.investigation }}
            </div>
        </div>
        <div class="row">
            <div class="col-sm">
                Expression
                {% if expression_spec %}({{ expression_spec }}){% endif %}
            </div>
            <div class="col-sm">
                {{ form.expression }}
            </div>
            <div class="col-sm">
                Firearms
                {% if firearms_spec %}({{ firearms_spec }}){% endif %}
            </div>
            <div class="col-sm">
                {{ form.firearms }}
            </div>
            <div class="col-sm">
                Law
                {% if law_spec %}({{ law_spec }}){% endif %}
            </div>
            <div class="col-sm">
                {{ form.law }}
            </div>
        </div>
        <div class="row">
            <div class="col-sm">
                Intimidation
                {% if intimidation_spec %}({{ intimidation_spec }}){% endif %}
            </div>
            <div class="col-sm">
                {{ form.intimidation }}
            </div>
            <div class="col-sm">
                Larceny
                {% if larceny_spec %}({{ larceny_spec }}){% endif %}
            </div>
            <div class="col-sm">
                {{ form.larceny }}
            </div>
            <div class="col-sm">
                Medicine
                {% if medicine_spec %}({{ medicine_spec }}){% endif %}
            </div>
            <div class="col-sm">
                {{ form.medicine }}
            </div>
        </div>
        <div class="row">
            <div class="col-sm">
                Leadership
                {% if leadership_spec %}({{ leadership_spec }}){% endif %}
            </div>
            <div class="col-sm">
                {{ form.leadership }}
            </div>
            <div class="col-sm">
                Melee
                {% if melee_spec %}({{ melee_spec }}){% endif %}
            </div>
            <div class="col-sm">
                {{ form.melee }}
            </div>
            <div class="col-sm">
                Occult
                {% if occult_spec %}({{ occult_spec }}){% endif %}
            </div>
            <div class="col-sm">
                {{ form.occult }}
            </div>
        </div>
        <div class="row">
            <div class="col-sm">
                Primal-Urge
                {% if primal_urge_spec %}({{ primal_urge_spec }}){% endif %}
            </div>
            <div class="col-sm">
                {{ form.primal_urge }}
            </div>
            <div class="col-sm">
                Performance
                {% if performance_spec %}({{ performance_spec }}){% endif %}
            </div>
            <div class="col-sm">
                {{ form.performance }}
            </div>
            <div class="col-sm">
                Rituals
                {% if rituals_spec %}({{ rituals_spec }}){% endif %}
            </div>
            <div class="col-sm">
                {{ form.rituals }}
            </div>
        </div>
        <div class="row">
            <div class="col-sm">
                Streetwise
                {% if streetwise_spec %}({{ streetwise_spec }}){% endif %}
            </div>
            <div class="col-sm">
                {{ form.streetwise }}
            </div>
            <div class="col-sm">
                Stealth
                {% if stealth_spec %}({{ stealth_spec }}){% endif %}
            </div>
            <div class="col-sm">
                {{ form.stealth }}
            </div>
            <div class="col-sm">
                Science
                {% if science_spec %}({{ science_spec }}){% endif %}
            </div>
            <div class="col-sm">
                {{ form.science }}
            </div>
        </div>
        <div class="row">
            <div class="col-sm">
                Subterfuge
                {% if subterfuge_spec %}({{ subterfuge_spec }}){% endif %}
            </div>
            <div class="col-sm">
                {{ form.subterfuge }}
            </div>
            <div class="col-sm">
                Survival
                {% if survival_spec %}({{ survival_spec }}){% endif %}
            </div>
            <div class="col-sm">
                {{ form.survival }}
            </div>
            <div class="col-sm">
                Technology
                {% if technology_spec %}({{ technology_spec }}){% endif %}
            </div>
            <div class="col-sm">
                {{ form.technology }}
            </div>
        </div>
    {% endblock abilities %}
    {% block backgrounds %}
        <div class="centertext container">
            <div class="row">
                <h2 class="col-sm {{ object.get_heading }}">
                    Backgrounds
                </h2>
            </div>
            <div class="row">
                <div class="col-sm">Allies</div>
                <div class="col-sm">{{ form.allies }}</div>
                <div class="col-sm">Ancestors</div>
                <div class="col-sm">{{ form.ancestors }}</div>
                <div class="col-sm">Contacts</div>
                <div class="col-sm">{{ form.contacts }}</div>
            </div>
            <div class="row">
                <div class="col-sm">Fate</div>
                <div class="col-sm">{{ form.fate }}</div>
                <div class="col-sm">Fetish</div>
                <div class="col-sm">{{ form.fetish }}</div>
                <div class="col-sm">Kinfolk</div>
                <div class="col-sm">{{ form.kinfolk_rating }}</div>
            </div>
            <div class="row">
                <div class="col-sm">Mentor</div>
                <div class="col-sm">{{ form.mentor }}</div>
                <div class="col-sm">Pure Breed</div>
                <div class="col-sm">{{ form.pure_breed }}</div>
                <div class="col-sm">Resources</div>
                <div class="col-sm">{{ form.resources }}</div>
            </div>
            <div class="row">
                <div class="col-sm">Rites</div>
                <div class="col-sm">{{ form.rites }}</div>
                <div class="col-sm">Spirit Heritage</div>
                <div class="col-sm">{{ form.spirit_heritage }}</div>
                <div class="col-sm">Totem</div>
                <div class="col-sm">{{ form.totem }}</div>
            </div>
        </div>
    {% endblock backgrounds %}
    {% block advantages %}
        <div class="row">
            <h2 class="col-sm {{ object.get_heading }}">
                Advantages
            </h2>
        </div>
        <div class="row">
            <div class="col-sm">
                Willpower
            </div>
            <div class="col-sm">
                {{ form.willpower }}
            </div>
            <div class="col-sm">
                Gnosis
            </div>
            <div class="col-sm">
                {{ form.gnosis }}
            </div>
            <div class="col-sm">
                Rage
            </div>
            <div class="col-sm">
                {{ form.rage }}
            </div>
        </div>
        <div class="row">
            <h2 class="col-sm {{ object.get_heading }}">
                Renown
            </h2>
        </div>
        <div class="row">
            <div class="col-sm">
                Glory
            </div>
            <div class="col-sm dots">
                {{ object.glory|dots:10 }}
            </div>
            <div class="col-sm">
                Honor
            </div>
            <div class="col-sm dots">
                {{ object.honor|dots:10 }}
            </div>
            <div class="col-sm">
                Wisdom
            </div>
            <div class="col-sm dots">
                {{ object.wisdom|dots:10 }}
            </div>
        </div>
        <div class="row">
            <div class="col-sm">
                Temporary Glory
            </div>
            <div class="col-sm dots">
                {{ object.temporary_glory|dots:10 }}
            </div>
            <div class="col-sm">
                Temporary Honor
            </div>
            <div class="col-sm dots">
                {{ object.temporary_honor|dots:10 }}
            </div>
            <div class="col-sm">
                Temporary Wisdom
            </div>
            <div class="col-sm dots">
                {{ object.temporary_wisdom|dots:10 }}
            </div>
        </div>
    {% endblock advantages %}
    {% block spheres %}
        <div class="row">
            <h2 class="col-sm {{ object.get_heading }}">
                Spheres
            </h2>
        </div>
        <div class="row">
            <div class="col-sm">
                {{ object.get_corr_name_display }}
                {% if correspondence_spec %}({{ correspondence_spec }}){% endif %}
            </div>
            <div class="col-sm">
                {{ form.correspondence }}
            </div>
            <div class="col-sm">
                Mind
                {% if mind_spec %}({{ mind_spec }}){% endif %}
            </div>
            <div class="col-sm">
                {{ form.mind }}
            </div>
            <div class="col-sm">
                {{ object.get_prime_name_display }}
                {% if prime_spec %}({{ prime_spec }}){% endif %}
            </div>
            <div class="col-sm">
                {{ form.prime }}
            </div>
        </div>
        <div class="row">
            <div class="col-sm">
                Entropy
                {% if entropy_spec %}({{ entropy_spec }}){% endif %}
            </div>
            <div class="col-sm">
                {{ form.entropy }}
            </div>
            <div class="col-sm">
                Life
                {% if life_spec %}({{ life_spec }}){% endif %}
            </div>
            <div class="col-sm">
                {{ form.life }}
            </div>
            <div class="col-sm">
                {{ object.get_spirit_name_display }}
                {% if spirit_spec %}({{ spirit_spec }}){% endif %}
            </div>
            <div class="col-sm">
                {{ form.spirit }}
            </div>
        </div>
        <div class="row">
            <div class="col-sm">
                Forces
                {% if forces_spec %}({{ forces_spec }}){% endif %}
            </div>
            <div class="col-sm">
                {{ form.forces }}
            </div>
            <div class="col-sm">
                Matter
                {% if matter_spec %}({{ matter_spec }}){% endif %}
            </div>
            <div class="col-sm">
                {{ form.matter }}
            </div>
            <div class="col-sm">
                Time
                {% if time_spec %}({{ time_spec }}){% endif %}
            </div>
            <div class="col-sm">
                {{ form.time }}
            </div>
        </div>
    {% endblock spheres %}
    {% block mfs %}
        <div class="row">
            <h2 class="col-sm {{ object.get_heading }}">
                Merits and Flaws
            </h2>
        </div>
        <div id="form-container">
            {{ formset.management_form }}
            {% for f in formset %}
                <div class="row meritform">
                    <div class="col-sm">
                        {{ f.mf }}
                    </div>
                    <div class="col-sm">
                        {{ f.rating }}
                    </div>
                </div>
            {% endfor %}
            <div class="row" id="add-form-top">
                <div class="col-sm">
                    <button class="btn btn-primary" type="button" id="add-form">
                        Add Merit/Flaw
                    </button>
                </div>
            </div>
        </div>
    {% endblock mfs %}
    {% block languages %}
        <div class="row">
            <h2 class="col-sm {{ object.get_heading }}">
                Languages
            </h2>
        </div>
        <div class="row">
            <div class="col-sm">
                Native Language
            </div>
            <div class="col-sm">
                {{ form.native_language }}
            </div>
            <div class="col-sm">
                Other Languages
            </div>
            <div class="col-sm">
                {{ form.languages }}
            </div>
        </div>
    {% endblock languages %}
    {% block appearance %}
    {% endblock appearance %}
    {% block history %}
    {% endblock history %}
    {% block advancement %}
    {% endblock advancement %}
</form>
{% block update %}
    <div class="row">
        <div class="col-sm">
            <input class="btn btn-primary" name="Back" type="submit" value="Back"/>
            <input class="btn btn-primary"
                   name="Random Freebies"
                   type="submit"
                   value="Random Freebies"/>
            <input class="btn btn-primary"
                   name="Assign Freebies"
                   type="submit"
                   value="Spend Freebies"/>
        </div>
    </div>
{% endblock update %}
{% block extrascripts %}
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
    let meritForm = document.querySelectorAll(".meritform")
    let container = document.querySelector("#form-container")
    let addButton = document.querySelector("#add-form")
    let addButtonTop = document.querySelector("#add-form-top")
    let totalForms = document.querySelector("#id_form-TOTAL_FORMS")
    let formNum = meritForm.length-1 // Get the number of the last form on the page with zero-based indexing
    addButton.addEventListener('click', addForm)
    function addForm(e) {
        e.preventDefault()
    
        let newForm = meritForm[0].cloneNode(true) //Clone the merit form
        let formRegex = RegExp(`form-(\\d){1}-`,'g') //Regex to find all instances of the form number
    
        formNum++ //Increment the form number
        newForm.innerHTML = newForm.innerHTML.replace(formRegex, `form-${formNum}-`) //Update the new form to have the correct form number
        container.insertBefore(newForm, addButtonTop) //Insert the new form at the end of the list of forms
    
        totalForms.setAttribute('value', `${formNum+1}`) //Increment the number of total forms in the management form
    }
    
    function addScript() {
        // Set the initial value of N and the maximum value of iterations
        let N = formNum;
      
        // Iterate N until the maximum number of iterations is reached
          // Replace the variable N in the script with the current value of N
          const scriptText = `$("#id_form-${N}-mf").change(function () {
              var url = "{% url 'wod:characters:mage:ajax_load_mf_ratings' %}"
              var mfId = $(this).val();
              $.ajax({
                  url: url,
                  data: {
                  'mf': mfId
                  },
                  success: function (data) {
                  $("#id_form-${N}-rating").html(data);
                  }
              });
          });`;
      
          // Create a new script element and set its text to the script text
          const script = document.createElement('script');
          script.textContent = scriptText;
      
          // Append the script element to the body of the page
          document.body.appendChild(script);
      }
      addButton.addEventListener('click', addScript);

    </script>
    <script>
    $("#id_form-0-mf").change(function () {
        var url = "{% url 'wod:characters:mage:ajax_load_mf_ratings' %}"
        var mfId = $(this).val();
        $.ajax({
            url: url,
            data: {
            'mf': mfId
            },
            success: function (data) {
            $("#id_form-0-rating").html(data);
            }
        });
    });
    </script>
{% endblock extrascripts %}
